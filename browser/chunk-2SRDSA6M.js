import{e as h}from"./chunk-UX74SWCT.js";import{A as u,O as i,S as c,X as o,hc as l,j as r,m as s}from"./chunk-DUJMT7CF.js";var a="http://localhost:5000/api/auth",b=class n{constructor(t,e){this.http=t;this.router=e;this.checkTokenOnInit()}isAuthenticatedSubject=new r(!1);currentUserSubject=new r(null);authInitializedSubject=new r(!1);isAuthenticated$=this.isAuthenticatedSubject.asObservable();currentUser$=this.currentUserSubject.asObservable();authInitialized$=this.authInitializedSubject.asObservable();checkTokenOnInit(){let t=this.getToken();this.isAuthenticatedSubject.next(!!t),this.authInitializedSubject.next(!0),t&&setTimeout(()=>{this.refreshUserInfo().subscribe()},0)}refreshUserInfo(){return this.getToken()?this.getUserInfo().pipe(i(t=>{this.currentUserSubject.next(t)}),u(t=>(console.error("Error fetching user info:",t),t.status===401&&this.logout(),s(null)))):(this.currentUserSubject.next(null),s(null))}registerUser(t){return this.http.post(`${a}/register`,t).pipe(i(e=>{e&&e.token&&(localStorage.setItem("token",e.token),this.isAuthenticatedSubject.next(!0),this.refreshUserInfo().subscribe())}))}login(t,e){return this.http.post(`${a}/login`,{email:t,password:e}).pipe(i(p=>{localStorage.setItem("token",p.token),this.isAuthenticatedSubject.next(!0),this.refreshUserInfo().subscribe()}))}logout(){localStorage.removeItem("token"),this.isAuthenticatedSubject.next(!1),this.currentUserSubject.next(null),this.router.navigate(["/login"])}getUserInfo(){return this.http.get(`${a}/me`)}getToken(){return localStorage.getItem("token")}isInitialized(){return this.authInitializedSubject.value}isAuthenticated(){return this.isAuthenticatedSubject.value}static \u0275fac=function(e){return new(e||n)(o(l),o(h))};static \u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})};export{b as a};
